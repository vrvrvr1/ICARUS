<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Customer</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <aside class="dashboard-sidebar">
    <div>
      <div class="sidebar-profile">
        <img src="/images/avatar.jpg" alt="Admin" class="sidebar-avatar" />
        <div>
          <div class="sidebar-welcome">Welcome back,</div>
          <div class="sidebar-name">Admin</div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <a href="/admin"><i class="bi bi-house-door"></i> Dashboard</a>
        <a href="/admin/sales"><i class="bi bi-graph-up"></i> Sales</a>
        <a href="/adminproducts"><i class="bi bi-box-seam"></i> Products</a>
        <a href="/customers" class="active"><i class="bi bi-people"></i> Customers</a>
        <a href="/orders"><i class="bi bi-bag-check"></i> Orders</a>
        <a href="/admin/audit-logs"><i class="bi bi-clipboard-check"></i> Audit Logs</a>
        <a href="/admin/settings"><i class="bi bi-gear"></i> Settings &amp; Configuration</a>
      </nav>
    </div>

    <div>
      <p class="text-center text-secondary small mb-0">© 2025 Icarus Wears</p>
    </div>
  </aside>

  <main class="dashboard-main">
    <div class="dashboard-header">
      <div>
        <div class="dashboard-title-main">Customer</div>
        <div class="dashboard-title-sub">Customer details and activity</div>
      </div>
      <div class="dashboard-search">
        <a href="/customers" class="btn btn-ghost">← Back to Customers</a>
      </div>
    </div>

    <div class="dashboard-card">
      <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
        <div style="width:120px;height:120px;flex:0 0 120px;border-radius:8px;overflow:hidden;background:#f6f6f6;display:flex;align-items:center;justify-content:center;">
          <img src="<%= customer.profile_image || '/image/profile1.png' %>" alt="avatar" style="max-width:100%;max-height:100%;object-fit:cover;" onerror="this.src='/image/profile1.png'" />
        </div>
        <div style="flex:1;min-width:240px;">
          <h2 style="margin:0"><%= (customer.first_name || '') + ' ' + (customer.last_name || '') %></h2>
          <div style="color:#666"><%= customer.email %></div>
          <div style="margin-top:8px;color:#666">Role: <strong><%= customer.role %></strong></div>
          <div style="margin-top:8px;color:#666">Phone: <%= customer.phone || '—' %></div>
        </div>
        <div style="text-align:right;min-width:180px;">
          <div style="font-size:14px;color:#666">Total Orders</div>
          <div style="font-weight:700;font-size:20px"><%= ordersCount %></div>
          <div style="margin-top:8px;font-size:13px;color:#666">Total Spent</div>
          <div style="font-weight:700;font-size:18px">$<%= (totalSpent||0).toFixed(2) %></div>
        </div>
      </div>

      <hr style="margin:16px 0" />

      <div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <h4 style="margin:0">Recent Orders</h4>
          <div></div>
        </div>
        <% if (!recent || recent.length === 0) { %>
          <div class="text-muted">No recent orders</div>
        <% } else { %>
          <table style="width:100%;border-collapse:collapse;">
            <thead>
              <tr style="text-align:left;color:#666;font-size:13px;">
                <th>Order</th>
                <th>Date</th>
                <th>Status</th>
                <th style="text-align:right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <% recent.forEach(r => { %>
                <tr>
                  <td><a href="/admin/orders/<%= r.id %>">#<%= r.id %></a></td>
                  <td><%= r.order_date ? new Date(r.order_date).toLocaleString() : '—' %></td>
                  <td><%= r.status %></td>
                  <td style="text-align:right">$<%= Number(r.total_amount||0).toFixed(2) %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        <% } %>
      </div>

      <!-- Edit/Delete removed per admin preference -->
    </div>
  </main>
</body>
</html>
